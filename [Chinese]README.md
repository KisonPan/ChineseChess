![](/icon.png)
# 中国象棋（[English Click Here](/README.md)）
*中国象棋 - 免费的 iOS App（C & Obj-C & Swift）*

## App 一览
### 启动页 & 主页
![](ReadMeMedia/Launch&Home.png)

### 对弈模块
![](ReadMeMedia/Game.png)

![](ReadMeMedia/GameSettings&History.png)

### 摆设棋局模块
![](ReadMeMedia/File&Edit.png)

![](ReadMeMedia/FirstSide&CheckMate.png)

### 棋谱模块
![](ReadMeMedia/History&Play.png)

### 联机模块
![](ReadMeMedia/MultiPeer&Waitting.png)

***

## 开发记录
* 2017.10.11, 正式启动工程.
* 2018.2.24, 完成联机模块，开始开发AI.
* 2018.9.27, 可以 __按棋谱库走棋__，棋谱库目前较小，有待扩展。

## 功能一览
### 对弈模块
- 支持人机对弈，可以选择AI等级（目前 __AI 正在调试__ ， 使用 __PVS__ 算法）。
- 支持立即的悔棋，新局，设置。
- 支持反转棋盘，反向棋子。
- 支持背景音乐的开关。

### 摆设棋局模块
- 支持清除、初始化棋盘。
- 支持在合理的格点处移除、摆放一颗棋子。
- 支持载入棋谱进行对弈。

### 棋谱模块
- 支持棋谱的读(演示)，保存，删除。
- 支持棋谱的任意一步跳转，点击即可跳转到这一步的局面。
- 支持在当前局面跳转对弈。

### 联机模块
- 支持两人对弈，通过蓝牙或者局域网。
- 支持悔棋、认输、提和。
- 支持新局。

## AI一览（[参考前辈黄晨的网站](http://www.xqbase.com/computer/eleeye_intro.htm)）
### 简单棋规
- 长将或长捉判负。
- 双方无进攻棋子判和。
- 50回合不吃子判和。
- 相同的局面出现多次判和。

### 棋盘棋子表示
- 棋盘：长度为256的数组。
- 棋子：16-31为红方棋子，依次为帥、仕仕、相相、馬馬、車車、炮炮、兵兵兵兵兵，32-47为黑方棋子，类似。

### 走法生成
- 短程类：帥仕相馬兵，走法预生成数组。
- 远程类：車炮，位行位列。

### 局面评估
- 局面预评估：分析局面的状态, 判断局面处于开中局或是残局。开中、残局的子力估值是不一样的。
- 局面动态评估：在搜索树的叶结点进行动态评估，分为两部分，一是子力位置价值，二是动态估值，动态估值包括缺少仕相的惩罚，馬的控制、牵制、保护，車的威胁、牵制、保护、灵活度，炮的威胁、牵制、保护、空头炮/沉底炮、灵活度的评估。

### 棋谱库
- 命中棋谱库：AI搜索前，可以查询棋谱库中有没有当前局面对应的着法，如果有的话，就直接拿来用，否则，AI进行搜索。另外，命中不一定是严格的局面对应，可以是左右翻转、红黑翻转，一共尝试搜索4个局面。
- 扩充棋谱库：棋谱文件分为两种，由每一步记录是否有FEN串来区分的，如果有FEN串，则这样的文件可以用来扩充棋谱库，传入棋谱文件所在的目录路径，这样可以用大量棋谱文件来扩充棋谱库，后期可以搜集大师的比赛棋谱来增强棋力。步骤如下，1. [LunaRecordStack historyFileWithCode:YES]; 2. [LunaRecordVault expandVaultWithDirectory:@"棋谱文件所在的目录"]; 3. [LunaRecordVault writeToFile:@"棋谱库的保存路径"];
